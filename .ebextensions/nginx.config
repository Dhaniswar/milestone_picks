files:
  "/etc/nginx/conf.d/elasticbeanstalk_https_redirect.conf":
    mode: "0644"
    owner: root
    group: root
    content: |
      server {
          listen 80;
          server_name _;

          return 301 https://$host$request_uri;
      }

  "/etc/nginx/conf.d/custom_log_format.conf":
    mode: "0644"
    owner: root
    group: root
    content: |
      http {
          types_hash_max_size 2048;
          types_hash_bucket_size 128;
          client_max_body_size 20M; 
          log_format custom '$remote_addr - $remote_user [$time_local] '
                            '"$request" $status $body_bytes_sent '
                            '"$http_referer" "$http_user_agent"';

          access_log /var/log/nginx/access.log custom;
      }

container_commands:
  01_max_body_size:
    command: |
      echo "client_max_body_size 20M;" > /etc/nginx/conf.d/client_max_body_size.conf
  02_restart_nginx:
    command: "service nginx restart"